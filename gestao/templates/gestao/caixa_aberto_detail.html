{% extends "includes/base_dashboard.html" %}
{% load omfilters %}

{% block titulo %}Pedidos{% endblock %}

{% block content %}


<div class="bg-gray-50 shadow rounded-lg p-4 sm:p-6 xl:p-8  2xl:col-span-2">

  <div class="flex items-center justify-between mb-4">
    <div class="flex-shrink-0"><br><br><br>
      <span class="text-2xl sm:text-3xl leading-none font-bold text-gray-900">Gestão do caixa {{ caixa.id }},
        {{ caixa.data }} <button id="dropdownDefaultButton" data-dropdown-toggle="dropdownCircle" type="button"><i
            class="fa-solid fa-circle-plus"></i>
          <svg class="w-4 h-4 ml-2" aria-hidden="true" fill="none" stroke="currentColor" viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg">
          </svg></button>
        <!-- Dropdown menu -->
        <div id="dropdownCircle"
          class="z-10 hidden bg-white divide-y divide-gray-100 rounded-lg shadow w-44 dark:bg-gray-700">
          <ul class="py-2 text-sm text-gray-700 dark:text-gray-200" aria-labelledby="dropdownDefaultButton">
            <li>
              <a href="#" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white"
                data-toggle="modal" data-target="#modalReforco">Reforço</a>
            </li>
            <li>
              <a href="#" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white"
                data-toggle="modal" data-target="#modalRetirada">Retirada</a>
            </li>
            <li>
              <form action="" method="post">
                {% csrf_token %}
                <button type="submit" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">Fechar Caixa</button>
              </form>
            </li>
            <li>
              <form method="post">
                {% csrf_token %}
            
                <button type="submit" name="reopen" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">Reabrir Caixa</button>
            </form>
            </li>
          </ul>
        </div>

        <!-- Modal de Reforço -->
        <div class="modal fade" id="modalReforco" tabindex="-1" role="dialog" aria-labelledby="modalReforcoLabel"
          aria-hidden="true">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="modalReforcoLabel">Reforço de Caixa</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <!-- Formulário para reforço de caixa -->
                <form action="{% url 'gestao:reforco_caixa' caixa.pk %}" method="post">
                  {% csrf_token %}
                  {{ reforco_form.as_p }}
                  <button type="submit" class="btn btn-primary">Confirmar</button>
                </form>
              </div>
            </div>
          </div>
        </div>

        <!-- Modal de Retirada -->
        <div class="modal fade" id="modalRetirada" tabindex="-1" role="dialog" aria-labelledby="modalRetiradaLabel"
          aria-hidden="true">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="modalRetiradaLabel">Retirada de Caixa</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <!-- Formulário para retirada de caixa -->
                <form action="{% url 'gestao:retirada_caixa' caixa.pk %}" method="post">
                  {% csrf_token %}
                  {{ retirada_form.as_p }}
                  <button type="submit" class="btn btn-primary">Confirmar</button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </span><br><br>
    </div>

  </div>

  <div class="relative overflow-x-auto shadow-md sm:rounded-lg">


    <div class="mt-4">
      <div class="bg-white shadow rounded-lg p-4 sm:p-6 xl:p-8 mb-4">
        <div class="flex items-center">
          <div class="flex-shrink-0">
            <span class="text-2xl sm:text-3xl leading-none font-bold text-gray-900">Resumo Geral</span><br><br>
            <h3 class="text-base font-normal text-gray-500" style="color: blue;">Quantidade de Vendas: {{ quantidade_aprovados }}</h3>
            {% if total_pedidos %}
            <h3 class="text-base font-normal text-gray-500" style="color: green;">Valor Total: R$ {{ total_pedidos|floatformat:2 }}</h3>
            {% else %}
            <h3 class="text-base font-normal text-gray-500">Valor Total: R$ 0</h3>
            {% endif %}
            {% if valor_medio_vendas %}
            <h3 class="text-base font-normal text-gray-500" style="color: blue;">Valor Médio das Vendas: R$ {{ valor_medio_vendas|floatformat:2 }}</h3>
            {% else %}
            <h3 class="text-base font-normal text-gray-500">Valor Médio das Vendas: R$ 0</h3>
            {% endif %}

          </div>
        </div>
      </div>

      <div class="bg-white shadow rounded-lg p-4 sm:p-6 xl:p-8 mb-4">
        <div class="flex items-center">
          <div class="flex-shrink-0">
            <span class="text-2xl sm:text-3xl leading-none font-bold text-gray-900">Resumo De Vendas</span><br><br>
            {% if total_pedidos %}
            <h3 class="text-base font-normal text-gray-500" style="color: green;">Total Vendido: R$ {{ total_pedidos|floatformat:2 }}
            </h3>
            {% else %}
            <h3 class="text-base font-normal text-gray-500">Total Vendido: R$ 0</h3>
            {% endif %}

            {% if soma_devolucoes %}
            <h3 class="text-base font-normal text-gray-500" style="color: red;">Devoluções: R$ {{ soma_devolucoes|floatformat:2 }}
            </h3>
            {% else %}
            <h3 class="text-base font-normal text-gray-500">Devoluções: R$ 0</h3>
            {% endif %}

          </div>
        </div>
      </div>

      <div class="bg-white shadow rounded-lg p-4 sm:p-6 xl:p-8 mb-4">
        <div class="flex items-center">
          <div class="flex-shrink-0">
            <span class="text-2xl sm:text-3xl leading-none font-bold text-gray-900">Dinheiro</span><br><br>
            <h3 class="text-base font-normal text-gray-500" style="color: blue;">Quantidade de vendas: {{ quantidade_pedidos_d }}</h3>
            <h3 class="text-base font-normal text-gray-500" style="color: green;">Total de vendas em Dinheiro: R${{ soma_quantidade_pedidos_d|floatformat:2 }}</h3>
          </div>
        </div>
      </div>
      <div class="bg-white shadow rounded-lg p-4 sm:p-6 xl:p-8 mb-4">
        <div class="flex items-center">
          <div class="flex-shrink-0">
            <span class="text-2xl sm:text-3xl leading-none font-bold text-gray-900">Cartão</span><br><br>
            <h3 class="text-base font-normal text-gray-500" style="color: blue;">Quantidade de vendas: {{ quantidade_pedidos_c }}</h3>
            <h3 class="text-base font-normal text-gray-500" style="color: green;">Total de vendas em Cartão: R${{ soma_quantidade_pedidos_c|floatformat:2 }}</h3>
          </div>
        </div>
      </div>
    </div>

      <div class="bg-white shadow rounded-lg p-4 sm:p-6 xl:p-8 mb-4">
        <div class="flex items-center">
          <div class="flex-shrink-0">
            <span class="text-2xl sm:text-3xl leading-none font-bold text-gray-900">Movimentações do
              Caixa</span><br><br>
            <h3 class="text-base font-normal text-gray-500" style="color: green;">Valor Inicial do Caixa (+):
              R$ {{ caixa.valor|floatformat:2 }}</h3>
            {% if total_pedidos %}
            <h3 class="text-base font-normal text-gray-500" style="color: green;">Total de Vendas (+): R$
              {{ total_pedidos|floatformat:2 }}</h3>
            {% else %}
            <h3 class="text-base font-normal text-gray-500">Total de Vendas (+): R$ 0</h3>
            {% endif %}
            {% if soma_fiados %}
            <h3 class="text-base font-normal text-gray-500" style="color: green;">Recebimentos (Fiado +): R$
              {{ soma_fiados|floatformat:2 }}</h3>
            {% else %}
            <h3 class="text-base font-normal text-gray-500">Recebimentos (Fiado +): R$ 0</h3>
            {% endif %}
            {% if soma_reforcos %}
            <h3 class="text-base font-normal text-gray-500" style="color: green;">Reforços (+): R${{ soma_reforcos|floatformat:2 }}
            </h3>
            {% else %}
            <h3 class="text-base font-normal text-gray-500">Reforços (+): R$0</h3>
            {% endif %}
            {% if soma_retiradas %}
            <h3 class="text-base font-normal text-gray-500" style="color: red;">Retiradas (-): R${{ soma_retiradas|floatformat:2 }}
            </h3>
            {% else %}
            <h3 class="text-base font-normal text-gray-500">Retiradas (-): R$0</h3>
            {% endif %}
            {% if diminuicao_fiados %}
            <h3 class="text-base font-normal text-gray-500" style="color: red;">Vendas Fiado (-): R$ {{ diminuicao_fiados|floatformat:2 }}</h3>
            {% else %}
            <h3 class="text-base font-normal text-gray-500">Vendas Fiado: R$ 0</h3>
            {% endif %}
            {% if soma_devolucoes %}
            <h3 class="text-base font-normal text-gray-500" style="color: red;">Devoluções: R$ {{ soma_devolucoes|floatformat:2 }}
            </h3>
            {% else %}
            <h3 class="text-base font-normal text-gray-500">Devoluções: R$ 0</h3>
            {% endif %}            
            {% if saldo %}
                {% if saldo < 0 %}
                    <h3 class="text-base font-normal text-red-500">Saldo: R$ {{ saldo|floatformat:2 }}</h3>
                {% else %}
                    <h3 class="text-base font-normal text-green-500">Saldo: R$ {{ saldo|floatformat:2 }}</h3>
                {% endif %}
            {% else %}
                <h3 class="text-base font-normal text-green-500">Saldo: R$ {{ caixa.valor|floatformat:2 }}</h3>
            {% endif %}          

          </div>
        </div>
      </div>

      

  </div>
</div>


{% endblock %}